#!/usr/bin/env zsh
#------------------------------------------------------------------------------------------------------------------------
# Default Values
YELLOW='\033[0;93m'      
GREEN='\033[0;32m'  
RED='\033[0;31m'      
CLEAR='\033[0m'
#------------------------------------------------------------------------------------------------------------------------
# Default Functions
echo_separator(){
    default_size=150
    output=""

    if [ ! -z "$1" ]; then
        text_size=`echo $1 | wc -c`
        begin=$(($default_size - $text_size))
        begin=$(($begin / 2))
        
        i=0
        while [ $i != $default_size ]; do
           if [[ $i == 0 ]] || [[ $i == $(($default_size - 1)) ]]; then 
                if [ ! -z "$2" ]; then
                    output+="$2"
                else
                    output+="|"
                fi
           elif [[ $i == $begin ]]; then
                output+="${YELLOW}$1${CLEAR}"
                i=$(($i + $text_size))
                i=$(($i - 2))
           else
                output+="="
           fi   

           i=$(($i + 1))
        done
    else
        i=0
        while [ $i != $default_size ]; do
           if [[ $i == 0 ]] || [[ $i == $(($default_size - 1)) ]]; then 
                if [ ! -z "$2" ]; then
                    output+="$2"
                else
                    output+="|"
                fi
           else
                output+="="
           fi   

           i=$(($i + 1))
        done
    fi

    echo $output
}
add_to_file_if_needed(){
    if ! grep -Fxq $1 $2; then
        if [ ! -z "$3" ]; then
            echo "# $3" >> $2
        fi

        echo $1 >> $2
    fi 
}
echo_finded() {
    if [ ! -z "$2" ]; then
        echo "✅ $1 encontrado $2"
    else
        echo "✅ $1 encontrado!"
    fi
}
echo_install() {
    echo "🛠️. Preparando para instalar $1"
}
echo_not_finded() {
    echo "❌ $1 não encontrado!"
    echo_install "$1 ..."
}
echo_green(){
    NOCOLOR='\033[0m'
    
    echo "${GREEN}$1${CLEAR}"
}
echo_red(){
    RED='\033[0;31m'
    NOCOLOR='\033[0m'
    echo "${RED}$1${CLEAR}"
}
install_plugin_in_asdf(){
    result=$(asdf current $1) 2>/dev/null
    plugin=$1
    
    if [[ $result == "" ]]; then
        echo_red "❌ $plugin não instalado no ASDF!"
        echo_install "$plugin no ASDF ..."
        version="latest"
        if [ ! -z "$2" ]; then
            version=$2
        fi

        asdf plugin add $plugin
        asdf install $plugin $version
        asdf global $plugin $version
        echo_green "✅ $plugin instalado no ASDF!"
    else
        echo_finded $plugin "no ASDF!"
    fi
}
#------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------
echo "                                              
                                ╓┐
                               å╬╬
                              ╔╬╣⌐
                             ,╣╬▒
                             ╣╬╬
                            ╢╬╬⌐                ,╓▄▄▄▄▌▌▌▌▄▄▄▄╖,
                           å╬╬▒            ,▄▓█▓▓██████████████████▓▄╓
                          ╔╬╬╬          ╓▓█▀╠▄▓████████████████████████▓▄
                         ,╣╬╬⌐        ▄██▄▓███████████████████████████████▓µ                          ▄▄▄▄▄▄      ▄▄▄▄     ▄▄▄▄     ▄▄▄▄ ▄▄▄▄▄▄▄▄▄▄▄▄   ▄▄▄▄▄▄  ▄▄▄▄
                         ╣╬╬╝       ,▓▀╫████████████████████████████████████▓,                   ,▓█████████ ▄▓████████▓▄  ████▌    ████ ████████████     ██   █   █
                        ╢╬╬╣       ▄██████████████████████████████████████████▄                 ╟████▀▀▀▀▀▀▀ ▓████▀▀▀▀███▌ █████   ▐████ ████             █▓   ▀▄▄▄▀
                       å╬╬╬░      ▄████████████████████████████████████████████▌                ████▌        ████     ▐███ █████████████ ████████
                      '╝╣╣╝      ╓██████████████████████████████████████████████▄               ╫████▄▄▄▄▄▄▄ ████     ▐███ ████ ▐██▌ ███ ████           ▀▀██▀▀ ██ ██ █▀▀▀
                    ▄▄█▓▄▄      ,▄▄▄▄▄▄▄▄▄▄▄▄▄╙▀▀███████████▓▀▀▀╙╠▄▄▄▄▄▄▄▄▄▄▄▄▄▄╟                ╙██████████  ▀███▄▄▄▄███▀ ████  ▀█  ███ ████████████     ▓█   █████ █▓▓
                  ,»▄└╙▀▓▓φ    ╒████████████████▓▌▄▄╙▀▀╙▄▄▄▓▓████████████████████▓                  ▀▀▀▀▀▀▀▀    ▀▀▀▀▀▀▀    ▀▀▀▀      ▀▀▀ ▀▀▀▀▀▀▀▀▀▀▀▀     ▓█   ██ ██ █▄▄▄
                 ≥░░▀▀▓▓▄     ╒████████╨│;┌┌┌└╙╨▀████▓▓████▓▀▀╙┘└└┴╨▀██████████████,
           «░≥-  ░░▀▓▓▓▄     ╓███████╝;░░░░░░≥╓;;┌└╨▓███▀╙:┌┌┌;;≤░░░░┤▓█████████████▄         ║╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣▓φ╓          ╣╣╣╣╣╣╣╣╣╣╣╣µ      ║╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣▓╗    ╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣Γ
           ░░░░░≥╫▓▓▓▌▄╢≥   ╓███████Ü░░░░░▄▓▓▄▒░░░░≥≤│¿┌;;≥░░░░░▒▄▓▌▒░░╫█████████████▌        ║╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣φ       ║╣╣╣╣╣╣╣╣╣╣╣╣╣      ║╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣▒  ╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣Γ
           ░░░░░║▀██████░≥ ╓███████▒░░░░▒▓██▌╓███▒░░░░░░░░░░░╫███,███▌░░╫█████████████▓       ║╣╣╣╣╣╣╣╣╣╣╣▌└└└└└╙╢╣╣╣╣╣╣╣╣▓     ╒╣╣╣╣╣╣▌╚╣╣╣╣╣╣▌     ║╣╣╣╣╣╣╣╬└└└└└╙╫╣╣╣╣╣╣⌐ ╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣Γ
           ╚░░░½▌▓█████▒░░╟▓▓█████▌⌠░░░░Å████Γ ╫██▒░░░░░░░░░▒████▌ └██▒░░╫█▓████████████           ╣╣╣╣╣╣╣▌       \"╣╣╣╣╣╣╣╣▌    ╣╣╣╣╣╣╣  ╫╣╣╣╣╣╣▒    ║╣╣╣╣╣╣╣▌      ]╣╣╣╣╣╣Γ        ╣╣╣╣╣╣╣⌐
            ░░░▓██▓╟╟▀▌▒░╫▌▐██████:░░░░░▒████▓▄██▒░░░▄╣▓╣▒░░░▓████▄▓█▓░░░░▓█╙████████████µ         ╣╣╣╣╣╣╣▌        ╟╣╣╣╣╣╣╣╬   ╣╣╣╣╣╣╣Γ   ╣╣╣╣╣╣╣⌐   ║╣╣╣╣╣╣╣▓▓▓▓▓▓▓╣╣╣╣╣╣╩         ╣╣╣╣╣╣╣⌐
            ²░║██▀░░░░░▒╫▌▄██████▌┌^░░░░░░╬████▓╡░░║▓▓▓▓▓▓▓░░░╬█████╢░░░░░░█▌▓████████████▄        ╣╣╣╣╣╣╣▌        ╣╣╣╣╣╣╣╣╣  ▐╣╣╣╣╣╣╩    └╣╣╣╣╣╣▓   ║╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╝╙           ╣╣╣╣╣╣╣⌐
        ░░░░≥≡▒╬▓░░░░░░╫█╣███████:┌┌^░░░░░░░░░░░░░░╟▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░:└█ █████████████▌       ╣╣╣╣╣╣╣▌       ╓╣╣╣╣╣╣╣╣Γ ,╣╣╣╣╣╣╣▓▓▓▓▓▓╣╣╣╣╣╣╣▌  ║╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣▌              ╣╣╣╣╣╣╣⌐
        \"░░░░░░▒▒░░░░░░▓████████▌┌┌┌┌┌└5░░░░░░░░░░░#▓▓▓▓▓▓▓░░░░░░░░░░░░░└┌┌;╟▌║████████████▀└      ╣╣╣╣╣╣╣▌╗╗╗╗╗φ╣╣╣╣╣╣╣╣╣▀  ╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣b ║╣╣╣╣╣╣╣▌ ╚╣╣╣╣╣╣╣╣╣╣╣╣╣▌      ╣╣╣╣╣╣╣⌐
         ²░░░░░░░▒░░░░░░┼╬▓█████▒┌┌┌┌┌┌┌┌└└░░░░░┘└;┌╙▓▓▓▓▓▒└└░╚ñèèè░░└:┌┌\"\"]░╫p╙╙▄▄████▓╙─         ╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╙  ║╣╣╣╣╣╣╣╨      ╙╣╣╣╣╣╣╣╣─║╣╣╣╣╣╣╣▌   ╚╣╣╣╣╣╣╣╣╣╣╣▌      ╣╣╣╣╣╣╣⌐
          \`╚░░░░░░░░░░░░░░░░∩┴╙╙:┌ '\"┌┌┌┌┌┌┌┌┌┌┌┌┌┌┌┌╫▓▓▓▓⌐┌┌┌┌┌┌┌┌┌┌┌\"'   !░░▓▓▀▀▀╟╡░░░≥          ╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╣╝╙└   ╔╣╣╣╣╣╣╣╬        ║╣╣╣╣╣╣╣▓║╣╣╣╣╣╣╣▌     ╙╣╣╣╣╣╣╣╣╣▌      ╣╣╣╣╣╣╣⌐
            \"è░░░░░░░░░░░░░░░┌┌┌┌\"    \`\"┌┌┌┌┌┌┌┌┌┌┌┌┌└▓▓▓▌┌┌┌┌┌┌┌┌┌\"'      ┌░░░░░░░░░░░░░░≥
              \`╙░░░░░░░░░░░░░░┌┌┌~        '^\"┌┌┌┌┌┌┌┌┌╢▓▓▒┌┌┌┌\"\"'          ^⌐░░░░░░░░░░░░░░░≥                                                     ▄▓██████████████ ▓██████████▓▓▄,   █████████████
                 \`²╚░░░░░░░░░░∩┌┌┌              ''\"\"--\"▓▓^\`                .┌!░░░░░░░░░░░░░░░                                                    ╫████████████████ ▓██████████████▓  █████████████
                    ,▓▓▓▄▄▄▒▒░░∩┌┌                     ╙▌                  ^┌┌▄▒░░░░░░░░░░░                                                      └██████▄    █████ ▓████Γ    ╙█████▓ █████
                 ▄▓█████████▌████p-                     \"                  ┌],██▓▄░░░░░░░░░        ╫███████████████████████████████████▌           ▀██████╥  █████ ▓████Γ     ██████ ██████████
            ,▄▓███████████▓████████▌╓                                    ▄▄██▌█████▓▒²²╚░░░                                                         ,██████▌ █████ ▓████Γ    ╓█████▌ █████
   ,,╓▄▄▓▓████████████████████████████▀▄▄,                         ,▄▄▓█████████████⌐                                                      ╟████████████████ █████ ▓█████▓▓▓██████▓  ██████████████
    ╙██████████████████████████████▀▄▓█▀▌▓█▓▌▌▄,▄╓,,    ,,╓▄▄ ▄▓▓▓██████████████████                                                       ╟██████████████▀─ █████ ▓███████████▓▀└   ██████████████
       └╙▀██████████████████████▓▀▀╫▄▓█████▓▓▓▓█████╨▓█████▀.███▓▓█████████████████▌
             ╙▀▀▀██████████████▄⌠╙▀▀███████▓██████▀ └╙╙╙╙└     └▓▓▓▓▓███▀▀▀╙╙└└└──└
                        └└└└└└└└─     ▓▓▀╣▓▓▓███▀             ,▓▓▓▓▀▀▓▌       
"                  
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Homebrew" "⏳"
echo ""
if ! which brew > /dev/null; then
    echo_not_finded "Homebrew"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    (echo; echo 'eval "$(/opt/homebrew/bin/brew shellenv)"') >> "$HOME/.zprofile"
    eval "$(/opt/homebrew/bin/brew shellenv)"
else 
    echo_finded "Homebrew"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Oh My Zsh" "⏳"
echo ""
if [ ! -d "$HOME/.oh-my-zsh/" ]; then
    echo_not_finded "Oh My Zsh"
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
else
    echo_finded "Oh My Zsh"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Power Level 10K" "⏳"
echo ""
if [ ! -d "$HOME/.oh-my-zsh/custom/themes/powerlevel10k/" ]; then
    echo_not_finded "Power Level 10K"
    git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k
    sed -i -- 's/ZSH_THEME="robbyrussell"/ZSH_THEME="powerlevel10k\/powerlevel10k"/g' $HOME/.zshrc
else
    echo_finded "Power Level 10K"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando VSCode" "⏳"
echo ""
if ! which code > /dev/null; then
    echo_not_finded "VSCode"
    brew install --cask visual-studio-code
else 
    echo_finded "VSCode"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Android Studio" "⏳"
echo ""
if ! ls /Applications/ | grep -i "Android\ Studio" >/dev/null; then
    echo_not_finded "Android Studio"
    brew install android-studio
else 
    echo_finded "Android Studio"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Docker" "⏳"
echo ""
if ! which docker > /dev/null; then
    echo_not_finded "Docker"
    brew install docker --cask
else 
    echo_finded "Docker"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando JQ" "⏳"
echo ""
if ! which jq > /dev/null; then
    echo_not_finded "JQ"
    brew install jq
else 
    echo_finded "JQ"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando ASDF" "⏳"
echo ""
if ! which asdf > /dev/null; then
    echo_not_finded "ASDF"
    brew install asdf
else 
    echo_finded "ASDF"
fi
add_to_file_if_needed '. $(brew --prefix asdf)/libexec/asdf.sh' ${ZDOTDIR:-~}/.zshrc "ASDF"
#------------------------------------------------------------------------------------------------------------------------
source ~/.zshrc
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Ruby" "⏳"
echo ""
install_plugin_in_asdf "ruby"
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Java" "⏳"
echo ""
install_plugin_in_asdf "java" "latest:adoptopenjdk-11"
add_to_file_if_needed '. $HOME/.asdf/plugins/java/set-java-home.zsh' ${ZDOTDIR:-~}/.zshrc "Java Home"
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando NodeJS" "⏳"
echo ""
install_plugin_in_asdf "nodejs"
#------------------------------------------------------------------------------------------------------------------------#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Python" "⏳"
echo ""
install_plugin_in_asdf "python"
#------------------------------------------------------------------------------------------------------------------------
source ~/.zshrc
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Cocoapods" "⏳"
echo ""
if ! which pod > /dev/null; then
    echo_not_finded "Cocoapods"
    gem install cocoapods
    echo_green "✅ Cocoapods instalado!"
else 
    echo_finded "Cocoapods"
fi
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Dart" "⏳"
echo ""
install_plugin_in_asdf "dart" "3.0.6"
#------------------------------------------------------------------------------------------------------------------------
echo ""
echo_separator "Verificando Flutter" "⏳"
echo ""
install_plugin_in_asdf "flutter" "3.10.6-stable"
#------------------------------------------------------------------------------------------------------------------------
